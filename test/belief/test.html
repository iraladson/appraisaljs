<script src="lexicon.js_"></script>
<script src="lexer.js"></script>
<script src="POSTagger.js"></script>
<script src="intention.js"></script>
<script type="text/javascript">

/*function belief_emoFact(){
	var aboutSelf = [];
	var aboutOther = [];
	var general = [];

	this.newBelief = function(obj){
		var belief = {

	        verb : obj.verb,

	        assertion : obj.assertion,

	        affirmative : obj.affirmative || true,

	        relation : obj.relation,

	        sentiment : obj.sentiment || 00,

	        magnitude : obj.magnitude || 0.25
		};

		if(obj.type == "aboutSelf"){
			aboutSelf.push(belief);
		} else if (obj.type == "aboutOther") {
			aboutOther.push(belief);
		} else {
			belief.subject = obj.type;
			general.push(belief);
		}

	}

	this.findBelief = function(string,checker,func,push){
		var checkFun = checker || new Intention_emoFact().getIntent;

		var stats = checkFun(string);

		var maxProp = null;
		var maxVal = 0;

		for(var prop in stats){
			if(stats.hasOwnProperty(prop)){
				var val = stats[prop];
				if((val > maxVal) && (prop != "own") && (prop != "id")){
					maxProp = prop;
					maxVal = val;
				}
			}
		}

		if(func){
			func(maxProp,maxVal,stats);
		} else {
			if(maxProp == "wasDeclar"){
				//identify subject
				//identify verb
				//identify assertion
				//reduce subject
				//reduce verb
				//reduce assertion
				//form belief

				var svo = (function identifySVO(posSentence){
					var subject = [];
					var verb = [];
					var object = [];
					var index = 0;
					var punct = isPunct(posSentence[posSentence.length-1].word);
					
					(function(){
						for(var i=index;i<posSentence.length;i += 1){
							if(posSentence[i].type != 'V'){
								subject.push(posSentence[i]);
							} else {
								index = i;
								return;
							}
						}
					})();
					
					(function(){
							verb.push(posSentence[index]);
							
							if(punct){
								verb.push(posSentence[posSentence.length-1]);
							}
							index += 1;
							return;
					})();
					
					(function(){
						for(var i=index;i<posSentence.length;i += 1){
							if(!punct || (punct && i != posSentence.length-1)){
								object.push(posSentence[i]);
							}
						}
					})();

					return { s : subject, v : verb, o : object };
				})(new PosSentence(string).specialSentence);

				console.log(svo);

				//FIND PLACEMENT!!!
				for(var i = 0; i < svo.s.length; i += 1){
					var word = svo.s[i].word;
				}

				this.newBelief({
					type : svo.s[svo.s.length-1].word,

					verb : svo.v[0].word ,

			        assertion : svo.o[0].word ,

			        relation : svo.o[0].type, 

				});

			}
		}

	}

	this.getBeliefs = function(){
		return general
	}
}

function PosWord(sentWord, sentType){
	this.word = sentWord;
	this.type = sentType;
}

function PosSentence(theInput){
	var words = new Lexer().lex(theInput);
	var taggedWords = new POSTagger().tag(words);
	
	this.specialSentence = [];
		   
	for (i in taggedWords) {
		var taggedWord = taggedWords[i];
		var word = taggedWord[0];
		var tag = taggedWord[1].charAt(0);; 

		this.specialSentence.push(new PosWord(word, tag));
	}
}

function isPunct(test){
	if(test == "," || isEnd(test)){
		return true
	} else {
		return false;
	}
}

function isEnd(test){
	if(test == "."){ 
		return "."
	} else if(test == "!"){
		return "!"
	} else if(test == "?"){
		return "?"
	} else if(test == ";"){
		return ";"
	} else {
		return false;
	}
}*/

function EMOAPS(){

		var components = [];
		var aems = [];
		var appraisalVar = [];

		this.updateFactors = function(){
			for (var i = 0; i < components.length; i++) {
				var component = components[i];

				for(var j = 0; j < aems.length; j++){
					var aem = aems[j];
					if(component.getId() == aem.getId()){
						components[i].update(aems[i].deliver());
						break;
					}
				}
			}
		}

		this.addComponent = function(comp){
			components.push(comp);
			aems.push(new comp.AEM())
		}

		this.getComponents = function(){
			return { components : components, aems : aems }
		}

		this.populateAEMS = function(objArray){
			for(var i=0; i < objArray.length; i += 1){
				var obj = objArray[i];
				for (var j = 0; j < aems.length; j++) {
					var aem = aems[j];
					if(aem.getId() == obj.id){
						aem.populate(obj);
					}
				}
			}
		}

		//MODULES//
		///////////
		this.Util = function() {
			var that = this;
			//Part Of Speech
			if(Lexer && POSTagger){
				this.PosWord = function(sentWord, sentType){
					this.word = sentWord;
					this.type = sentType;
				}

				this.PosSentence = function(theInput){
					var words = new Lexer().lex(theInput);
					var taggedWords = new POSTagger().tag(words);
					
					this.specialSentence = [];
						   
					for (i in taggedWords) {
						var taggedWord = taggedWords[i];
						var word = taggedWord[0];
						var tag = taggedWord[1].charAt(0);

						this.specialSentence.push(new that.PosWord(word, tag));
					}

				}
			} else {
				console.log("No part of speech utility");
			}

			//Syntax
			this.isPunct = function(test){
				if(test == "," || this.isEnd(test)){
					return true
				} else {
					return false;
				}
			}

			this.isEnd = function(test){
				if(test == "."){ 
					return "."
				} else if(test == "!"){
					return "!"
				} else if(test == "?"){
					return "?"
				} else if(test == ";"){
					return ";"
				} else {
					return false;
				}
			}
		}//end of util

}



EMOAPS.Intention = function(){

	var util = new EMOAPS().Util;
	var PosSentence = new util().PosSentence;

	var IntentStruct = function(id,s,q,d,i,bool){

		this.id = id;

		this.string = s;

		this.wasQuestYN = q.yn;
		
		this.wasQuestAlt = q.alt;
		
		this.wasQuestOpen = q.open;

		this.wasDeclar = d;

		this.wasImper = i;

		this.own = bool;
	}

	var id = "Intention";


	var log = [];
	var currentId = 0;
	var self;
	var other;

	this.getId = function(){
		return id;
	}

	this.newIntention = function(sentence,selfBool){
		var sent = new IntentSentence(sentence.trim());
		var _self = selfBool || true;
		console.log("Intent sentence made")
		if(_self){
			self = new IntentStruct(currentId,sent.string,sent.isQuestion(),sent.isDeclar(),sent.isImper(),true);

			log.push(new IntentStruct(currentId,sent.string,sent.isQuestion(),sent.isDeclar(),sent.isImper(),true));
		} else {
			other = new IntentStruct(currentId,sent.string,sent.isQuestion(),sent.isDeclar(),sent.isImper(),false);

			log.push(new IntentStruct(currentId,sent.string,sent.isQuestion(),sent.isDeclar(),sent.isImper()),false);
		}
		console.log(log);		

		return log;	
	}

	this.getLog = function(){
		return log;
	}
	
	this.getIntent = function(type){
		var _self = type || true;
		
		if(typeof _self == "string"){
			var sent = new IntentSentence(sentence.trim());
			return new IntentStruct(currentId,sent.string,sent.isQuestion(),sent.isDeclar(),sent.isImper());
		}
		
		if(_self) return self;

		return other;
		
	}


	function IntentSentence(sentence){
		var sent = sentence.split(" ");
		var posSent = new PosSentence(sentence).specialSentence;


		var verbFound = false;

		for(var i = 0; i < posSent.length; i+=1){
			var posWord = posSent[i];
			if(posWord.type == "V"){
				verbFound = true;
				break;
			}
		}

		if(!verbFound) posSent[0].type = "V";

		this.string = sentence;

		this.isQuestion = function(){

			var confidence = { yn : 0, alt : 0, open : 0 };

			for(var i = 0; i < sent.length; i++){
				var word = sent[i].toLowerCase();
				
				if(word == "or" || word == "and"){
					confidence.alt += 0.15;
				}

				
				if((word == "can") ||
					(word == "did") ||
					(word == "are") ||
					(word == "do") ||
					(word == "does") ||
					(word == "is") ||
					(word == "would") ||
					(word == "should") ||
					(word == "could") ||
					(word == "do") ||
					(word == "will")){
						if(i == 0){
							confidence.yn += .5;
							confidence.alt += .3;
						} else {
							confidence.yn += .3;
							confidence.alt += .2;
						}
				}

				if((word == "what") ||
					(word == "where") ||
					(word == "who") ||
					(word == "what") ||
					(word == "which") ||
					(word == "how") ||
					(word == "why")){
						if(i == 0){
							confidence.open += .5;
						} else {
							confidence.open += .3;
						}
				}

				if(word.indexOf("?") != -1){
					confidence.yn += .45; 
					confidence.alt += .45;
					confidence.open += .45; 
				}

			}

	//		for(ele in confidence){
	//			if(confidence[ele] >= threshold){
					return confidence;
	//			}
	//			return undefined;
	//		}
		}

		this.isDeclar = function(){
			var confidence = 0;

			if(posSent[0].type != "V"){
				confidence += .4;
			}

			if(posSent[posSent.length-1] == "."){
				confidence += .2;
			}

			return confidence;
		}

		this.isImper = function(){
			var confidence = 0;

			if(posSent[0].type == "V"){
				confidence += .4;
			}

			if(posSent[posSent.length-1] == "."){
				confidence += .2;
			}

			return confidence;
		}
	}

	this.update = function(obj){
		return this.newIntention(obj.sentence, obj.self);
	}
	

	//AEM
	this.AEM = function(){
		//var that = this;
		var id = "Intention";

		this.string = "";
		this.self = true;

		this.populate = function(obj){
			this.string = obj.sentence;
			this.self = obj.self || true;
		}

		this.deliver = function(){
			return { sentence : this.string, self : this.self }
		}

		this.getId = function(){
			return id;
		}
	}


}

function test(){
	var intent = new EMOAPS.Intention()

var model = new EMOAPS();

model.addComponent(intent);

model.populateAEMS([{id:"Intention", sentence:"Go to the store", subject:true}])

model.updateFactors();
}
</script>